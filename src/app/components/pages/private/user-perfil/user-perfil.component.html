<app-public-header></app-public-header>
<div class="profile-container">
  <div class="profile-sidebar">
    <div class="profile-card">
      <div class="profile-image-container">
        <img *ngIf="imagePreview" [src]="imagePreview" alt="Foto de Perfil" class="profile-avatar" />
        <div *ngIf="!imagePreview" class="profile-avatar-placeholder">
          <mat-icon>person</mat-icon>
        </div>
        <div class="image-upload-actions">
          <button mat-icon-button class="upload-btn" (click)="fileInput.click()" matTooltip="Alterar foto">
            <mat-icon>photo_camera</mat-icon>
          </button>
          <input type="file" #fileInput style="display: none;" (change)="onFileSelected($event)" accept="image/*" />
          <button mat-icon-button class="upload-btn" color="primary" (click)="uploadImagem()" [disabled]="!selectedFile" matTooltip="Salvar foto">
            <mat-icon>save</mat-icon>
          </button>
        </div>
      </div>
      <div class="profile-info">
        <h2>{{ (usuario$ | async)?.nome }}</h2>
        <p>{{ (usuario$ | async)?.email }}</p>
      </div>
    </div>

    <mat-nav-list class="profile-menu">
      <a mat-list-item routerLink="/minha-conta" routerLinkActive="active">
        <mat-icon>account_circle</mat-icon>
        <span>Informações Pessoais</span>
      </a>
      <a mat-list-item routerLink="/seguranca" routerLinkActive="active">
        <mat-icon>lock</mat-icon>
        <span>Segurança</span>
      </a>
      <a mat-list-item routerLink="/pedidos" routerLinkActive="active">
        <mat-icon>receipt</mat-icon>
        <span>Meus Pedidos</span>
      </a>
    </mat-nav-list>
  </div>

  <div class="profile-content">
    <mat-card class="content-card">
      <mat-card-header>
        <mat-card-title>Informações Pessoais</mat-card-title>
        <mat-card-subtitle>Atualize seus dados de contato e endereços</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <form [formGroup]="perfilForm" (ngSubmit)="onSubmit()" class="profile-form">
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Nome Completo</mat-label>
              <input matInput formControlName="nome" required />
              <mat-icon matSuffix>person</mat-icon>
              <mat-error *ngIf="perfilForm.get('nome')?.hasError('required')">
                Nome é obrigatório
              </mat-error>
              <mat-error *ngIf="perfilForm.get('nome')?.hasError('minlength')">
                Nome deve ter pelo menos 3 caracteres
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>E-mail</mat-label>
              <input matInput formControlName="email" type="email" required />
              <mat-icon matSuffix>email</mat-icon>
              <mat-error *ngIf="perfilForm.get('email')?.hasError('required')">
                Email é obrigatório
              </mat-error>
              <mat-error *ngIf="perfilForm.get('email')?.hasError('email')">
                Email inválido
              </mat-error>
              <mat-error *ngIf="perfilForm.get('email')?.hasError('emailExists')">
                Email já está em uso
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Login</mat-label>
              <input matInput formControlName="login" required />
              <mat-icon matSuffix>alternate_email</mat-icon>
              <mat-error *ngIf="perfilForm.get('login')?.hasError('required')">
                Login é obrigatório
              </mat-error>
              <mat-error *ngIf="perfilForm.get('login')?.hasError('minlength')">
                Login deve ter pelo menos 3 caracteres
              </mat-error>
              <mat-error *ngIf="perfilForm.get('login')?.hasError('loginExists')">
                Login já está em uso
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Senha</mat-label>
              <input matInput type="password" formControlName="senha" />
              <mat-icon matSuffix>vpn_key</mat-icon>
              <mat-hint>Deixe em branco para não alterar</mat-hint>
              <mat-error *ngIf="perfilForm.get('senha')?.hasError('minlength')">
                A senha deve ter pelo menos 6 caracteres
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-actions">
            <button mat-raised-button color="primary" type="submit" [disabled]="perfilForm.invalid">
              <mat-icon>save</mat-icon>
              Salvar Alterações
            </button>
          </div>
        </form>

        <div class="contact-section">
          <div class="section-header">
            <h3>Telefones</h3>
            <button mat-stroked-button color="primary" (click)="openTelefoneDialog()">
              <mat-icon>add</mat-icon>
              Adicionar Telefone
            </button>
          </div>

          <mat-list class="contact-list">
            <mat-list-item *ngIf="(usuario$ | async)?.telefones?.length === 0">
              <p>Nenhum telefone cadastrado</p>
            </mat-list-item>
            <mat-list-item *ngFor="let telefone of (usuario$ | async)?.telefones; let i = index" class="contact-item">
              <mat-icon matListIcon>phone</mat-icon>
              <div matLine>
                <span>({{ telefone.codigoArea }}) {{ telefone.numero }}</span>
              </div>
              <button mat-icon-button color="warn" (click)="removeTelefone(i)" matTooltip="Remover telefone">
                <mat-icon>delete</mat-icon>
              </button>
            </mat-list-item>
          </mat-list>
        </div>

        <div class="contact-section">
          <div class="section-header">
            <h3>Endereços</h3>
            <button mat-stroked-button color="primary" (click)="openEnderecoDialog()">
              <mat-icon>add</mat-icon>
              Adicionar Endereço
            </button>
          </div>

          <mat-list class="contact-list">
            <mat-list-item *ngIf="(usuario$ | async)?.enderecos?.length === 0">
              <p>Nenhum endereço cadastrado</p>
            </mat-list-item>
            <mat-list-item *ngFor="let endereco of (usuario$ | async)?.enderecos; let i = index" class="contact-item">
              <mat-icon matListIcon>location_on</mat-icon>
              <div matLine>
                <span>{{ endereco.rua }}, {{ endereco.numero }}</span>
                <span class="secondary-text">{{ endereco.cidade }} - {{ endereco.estado }}, {{ endereco.cep }}</span>
              </div>
              <button mat-icon-button color="warn" (click)="removeEndereco(i)" matTooltip="Remover endereço">
                <mat-icon>delete</mat-icon>
              </button>
            </mat-list-item>
          </mat-list>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
<app-footer></app-footer>